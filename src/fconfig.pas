unit fconfig;{  Configuration form of AWGG  Copyright (C) 2015 Reinier Romero Mir  nenirey@gmail.com  This library is free software; you can redistribute it and/or modify it  under the terms of the GNU Library General Public License as published by  the Free Software Foundation; either version 2 of the License.  This program is distributed in the hope that it will be useful, but WITHOUT  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or  FITNESS FOR A PARTICULAR PURPOSE. See the GNU Library General Public License  for more details.  You should have received a copy of the GNU Library General Public License  along with this library; if not, write to the Free Software Foundation,  Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.}{$mode objfpc}{$H+}interfaceuses  Classes, SysUtils, DateTimePicker, Forms, Dialogs,  ComCtrls, StdCtrls, Spin, EditBtn, ExtCtrls, Buttons, LCLIntf, fstrings,  fadd, freplace, fconfirm;type  { Tfrconfig }  Tfrconfig = class(TForm)    btnConfigAccept: TButton;    btnConfigCancel: TButton;    btnConfigApply: TButton;    btnFirefoxIntegration: TButton;    btnPreviewNotification: TButton;    chSaveDownLogs: TCheckBox;    chStopQueue: TCheckBox;    chEnableScheduler: TCheckBox;    chLoadLogs: TCheckBox;    chShutdown: TCheckBox;    chDownUseAgent: TCheckBox;    chAria2UseMultiConnections: TCheckBox;    chUseAuth: TCheckBox;    chDaily: TCheckBox;    chShowNotifications: TCheckBox;    chSameProxy: TCheckBox;    chClipboardMonitor: TCheckBox;    chPlaySounds: TCheckBox;    chDisableLimits: TCheckBox;    chQueueRotate: TCheckBox;    chgWgetDefArguments: TCheckGroup;    chgAria2DefArguments: TCheckGroup;    chgCurlDefArguments: TCheckGroup;    chgAutomation: TCheckGroup;    chgWeekDays: TCheckGroup;    chgAxelDefArguments: TCheckGroup;    cbProxy: TComboBox;    cbDefLanguage: TComboBox;    cbDefEngine: TComboBox;    cbQueue: TComboBox;    deStartQueue: TDateEdit;    deStopQueue: TDateEdit;    dtpStartQueue: TDateTimePicker;    dtpStopQueue: TDateTimePicker;    deDownFolder: TDirectoryEdit;    deLogsPath: TDirectoryEdit;    deCategoryDownFolder: TDirectoryEdit;    edtHTTPhost: TEdit;    edtAxelAdditionalArgs: TEdit;    edtDownAgent: TEdit;    edtAria2SplitSize: TEdit;    edtSSLhost: TEdit;    edtFTPhost: TEdit;    edtNoProxyHosts: TEdit;    edtProxyUser: TEdit;    edtProxyPass: TEdit;    edtWgetAdditionalArgs: TEdit;    edtAria2AdditionalArgs: TEdit;    edtCurlAdditionalArgs: TEdit;    fneWgetpath: TFileNameEdit;    fneAria2Path: TFileNameEdit;    fneCurlPath: TFileNameEdit;    fneAxelPath: TFileNameEdit;    fneSoundComplete: TFileNameEdit;    fneSoundStopped: TFileNameEdit;    gbLogsLoadMode: TGroupBox;    gbDownConnection: TGroupBox;    gbEngine: TGroupBox;    gbSounds: TGroupBox;    gbQueueRotateMode: TGroupBox;    gbAria2MultiConnections: TGroupBox;    gbUserAgent: TGroupBox;    lblHTTPhost: TLabel;    lblStartQueue: TLabel;    lblQueue: TLabel;    lblHideIn: TLabel;    lblSeconds: TLabel;    lblDownFolder: TLabel;    lblWgetPath: TLabel;    lblAria2Path: TLabel;    lblCurlPath: TLabel;    lblWgetAdditionalArgs: TLabel;    lblAria2AdditionalArgs: TLabel;    lblSSLhost: TLabel;    lblDefEngine: TLabel;    lblCurlAdditionalArgs: TLabel;    lblLogsPath: TLabel;    lblAxelPath: TLabel;    lblAxelAdditionalArgs: TLabel;    lblSoundDownComplete: TLabel;    lblSoundDownStoped: TLabel;    lblNoProxyHelp: TLabel;    lblCategoryDownFolder: TLabel;    lblCategory: TLabel;    lblFTPhost: TLabel;    lblExtensions: TLabel;    lblAria2Connections: TLabel;    lblDownTimeOut: TLabel;    lblDownTries: TLabel;    lblDownDelayTries: TLabel;    lblHTTPport: TLabel;    lblDefLanguage: TLabel;    lblQueueTriesRotate: TLabel;    lblQueueDelaySec: TLabel;    lblAria2SplitSize: TLabel;    lblSSLport: TLabel;    lblFTPport: TLabel;    lblNoProxyHosts: TLabel;    lblProxyUser: TLabel;    lblProxyPass: TLabel;    lbCategory: TListBox;    lbExtensions: TListBox;    PageControl1: TPageControl;    pConfigInfo: TPanel;    //RadioButton1: TRadioButton;    rbQueueRMToEnd: TRadioButton;    rbQueueRMTwoStop: TRadioButton;    rbLogsLoadAll: TRadioButton;    rbLogsLoadLines: TRadioButton;    rbCategoryOneFolder: TRadioButton;    rbCategoryByType: TRadioButton;    rbQueueRMOneStep: TRadioButton;    rgPosition: TRadioGroup;    rgCategorize: TRadioGroup;    btnPlayComplete: TSpeedButton;    btnPlayStopped: TSpeedButton;    btnAddQueue: TSpeedButton;    btnAddCategory: TSpeedButton;    btnDeleteCategory: TSpeedButton;    btnAddExtension: TSpeedButton;    btnDeleteExtension: TSpeedButton;    btnEditCategory: TSpeedButton;    seHTTPport: TSpinEdit;    seDownTimeOut: TSpinEdit;    seDownTries: TSpinEdit;    seDownDelayTries: TSpinEdit;    seQueueTriesRotate: TSpinEdit;    seQueueDelaySec: TSpinEdit;    seSSLport: TSpinEdit;    seFTPport: TSpinEdit;    seHideSeconds: TSpinEdit;    seAria2Connections: TSpinEdit;    tsProxy: TTabSheet;    tsLogs: TTabSheet;    tsAxel: TTabSheet;    tsIntegration: TTabSheet;    tsDownOptions: TTabSheet;    tsLang: TTabSheet;    tsSounds: TTabSheet;    tsQueue: TTabSheet;    tsScheduler: TTabSheet;    tsNotifications: TTabSheet;    tsClipboardm: TTabSheet;    tsFolders: TTabSheet;    tsWget: TTabSheet;    tsAria2: TTabSheet;    tsCurl: TTabSheet;    tsAutomation: TTabSheet;    tvConfig: TTreeView;    procedure btnConfigAcceptClick(Sender: TObject);    procedure btnConfigCancelClick(Sender: TObject);    procedure btnConfigApplyClick(Sender: TObject);    procedure btnFirefoxIntegrationClick(Sender: TObject);    procedure btnPreviewNotificationClick(Sender: TObject);    procedure chStopQueueChange(Sender: TObject);    procedure chEnableSchedulerChange(Sender: TObject);    procedure chLoadLogsChange(Sender: TObject);    procedure chUseAuthChange(Sender: TObject);    procedure chDailyChange(Sender: TObject);    procedure chSameProxyChange(Sender: TObject);    procedure chQueueRotateChange(Sender: TObject);    procedure cbProxyChange(Sender: TObject);    procedure cbQueueChange(Sender: TObject);    procedure deDownFolderAcceptDirectory(Sender: TObject; var Value: String);    procedure FormShow(Sender: TObject);    procedure lbCategorySelectionChange(Sender: TObject; User: boolean);    procedure PageControl1Change(Sender: TObject);    procedure btnPlayCompleteClick(Sender: TObject);    procedure btnPlayStoppedClick(Sender: TObject);    procedure btnAddQueueClick(Sender: TObject);    procedure btnAddCategoryClick(Sender: TObject);    procedure btnDeleteCategoryClick(Sender: TObject);    procedure btnAddExtensionClick(Sender: TObject);    procedure btnDeleteExtensionClick(Sender: TObject);    procedure btnEditCategoryClick(Sender: TObject);    procedure tvConfigSelectionChanged(Sender: TObject);  private    { private declarations }  public    { public declarations }  end;var  frconfig: Tfrconfig;  //setconfig:boolean;  categoryextencionstmp:array of TStringList;implementationUses fmain;{$R *.lfm}{ Tfrconfig }procedure categoryreload();var  i:integer;begin  frconfig.lbCategory.Items.Clear;  for i:=0 to Length(categoryextencionstmp)-1 do  begin    try      frconfig.lbCategory.Items.Add(categoryextencionstmp[i][1]);    except on e:exception do      //ShowMessage(e.ToString);    end;  end;end;procedure extencionreload();begin  frconfig.lbCategorySelectionChange(nil,false);end;procedure categorydelete(indice:integer);var  templistarray:array of TStringlist;  i:integer;begin  SetLength(templistarray,Length(categoryextencionstmp)-1);  for i:=0 to Length(categoryextencionstmp)-1 do  begin    if i<>indice then    begin      if i<indice then      begin        templistarray[i]:=TStringList.Create;        templistarray[i]:=categoryextencionstmp[i];      end      else      begin        templistarray[i-1]:=TStringList.Create;        templistarray[i-1]:=categoryextencionstmp[i];      end;    end;  end;  categoryextencionstmp:=templistarray;  categoryreload();end;procedure Tfrconfig.btnConfigCancelClick(Sender: TObject);begin  categoryextencionstmp:=categoryextencions;  frconfig.Close;end;procedure Tfrconfig.btnConfigApplyClick(Sender: TObject);var  validate:boolean;  n:integer;begin  validate:=false;  if frconfig.chDaily.Checked and frconfig.chEnableScheduler.Checked then  begin    for n:=0 to frconfig.chgWeekDays.Items.Count-1 do    begin      if frconfig.chgWeekDays.Checked[n] then        validate:=true;    end;  end  else    validate:=true;  if validate then  begin    fmain.setconfig();  end  else  begin    ShowMessage(fstrings.msgmustselectweekday);    frconfig.tsScheduler.Show;  end;end;procedure Tfrconfig.btnFirefoxIntegrationClick(Sender: TObject);begin  ShowMessage(fstrings.firefoxhelpintegration);  setfirefoxintegration();  OpenURL('http://sites.google.com/site/awggproject');  frconfig.Close;end;procedure Tfrconfig.btnPreviewNotificationClick(Sender: TObject);begin createnewnotifi('AWGG',Application.Params[0],TimeToStr(Now()),'',false,frconfig.rgPosition.ItemIndex);end;procedure Tfrconfig.chStopQueueChange(Sender: TObject);begin  frconfig.dtpStopQueue.Enabled:=frconfig.chStopQueue.Checked;  frconfig.deStopQueue.Enabled:=(not frconfig.chDaily.Checked) and frconfig.chStopQueue.Checked;end;procedure Tfrconfig.chEnableSchedulerChange(Sender: TObject);begin  frconfig.chDaily.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.chDisableLimits.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.lblStartQueue.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.chStopQueue.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.deStartQueue.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.deStopQueue.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.dtpStartQueue.Enabled:=frconfig.chEnableScheduler.Checked;  frconfig.dtpStopQueue.Enabled:=frconfig.chEnableScheduler.Checked;  if frconfig.chEnableScheduler.Checked then  begin    frconfig.chDailyChange(nil);    frconfig.chStopQueueChange(nil);  end;end;procedure Tfrconfig.chLoadLogsChange(Sender: TObject);begin  frconfig.gbLogsLoadMode.Enabled:=frconfig.chLoadLogs.Checked;end;procedure Tfrconfig.chUseAuthChange(Sender: TObject);begin  if frconfig.cbProxy.ItemIndex=2 then  begin    frconfig.lblProxyUser.Enabled:=frconfig.chUseAuth.Checked;    frconfig.lblProxyPass.Enabled:=frconfig.chUseAuth.Checked;    frconfig.edtProxyUser.Enabled:=frconfig.chUseAuth.Checked;    frconfig.edtProxyPass.Enabled:=frconfig.chUseAuth.Checked;  end;end;procedure Tfrconfig.chDailyChange(Sender: TObject);begin  if chDaily.Checked then  begin    frconfig.deStartQueue.Enabled:=false;    frconfig.deStopQueue.Enabled:=false;    chgWeekDays.Enabled:=true;  end  else  begin    frconfig.deStartQueue.Enabled:=true;    frconfig.deStopQueue.Enabled:=frconfig.chStopQueue.Checked;    chgWeekDays.Enabled:=false;  end;end;procedure Tfrconfig.chSameProxyChange(Sender: TObject);begin  if frconfig.cbProxy.ItemIndex = 2 then  begin    if chSameProxy.Checked then    begin      edtSSLhost.Text:=edtHTTPhost.Text;      edtFTPhost.Text:=edtHTTPhost.Text;      seSSLport.Value:=seHTTPport.Value;      seFTPport.Value:=seHTTPport.Value;      edtSSLhost.Enabled:=false;      edtFTPhost.Enabled:=false;      seSSLport.Enabled:=false;      seFTPport.Enabled:=false;   end   else   begin     edtSSLhost.Enabled:=true;     edtFTPhost.Enabled:=true;     seSSLport.Enabled:=true;     seFTPport.Enabled:=true;   end;  end;end;procedure Tfrconfig.chQueueRotateChange(Sender: TObject);begin  frconfig.gbQueueRotateMode.Enabled:=frconfig.chQueueRotate.Checked;end;procedure Tfrconfig.cbProxyChange(Sender: TObject);begin  Case frconfig.cbProxy.ItemIndex of    0,1:    begin      frconfig.edtHTTPhost.Enabled:=false;      frconfig.edtSSLhost.Enabled:=false;      frconfig.edtFTPhost.Enabled:=false;      frconfig.edtNoProxyHosts.Enabled:=false;      frconfig.edtProxyUser.Enabled:=false;      frconfig.edtProxyPass.Enabled:=false;      frconfig.lblHTTPhost.Enabled:=false;      frconfig.lblSSLhost.Enabled:=false;      frconfig.lblFTPhost.Enabled:=false;      frconfig.lblHTTPport.Enabled:=false;      frconfig.lblSSLport.Enabled:=false;      frconfig.lblFTPport.Enabled:=false;      frconfig.lblNoProxyHosts.Enabled:=false;      frconfig.lblProxyUser.Enabled:=false;      frconfig.lblProxyPass.Enabled:=false;      frconfig.lblNoProxyHelp.Enabled:=false;      frconfig.seHTTPport.Enabled:=false;      frconfig.seSSLport.Enabled:=false;      frconfig.seFTPport.Enabled:=false;      frconfig.chSameProxy.Enabled:=false;      frconfig.chUseAuth.Enabled:=false;    end;    2:    begin      frconfig.edtHTTPhost.Enabled:=true;      frconfig.edtSSLhost.Enabled:=true;      frconfig.edtFTPhost.Enabled:=true;      frconfig.edtNoProxyHosts.Enabled:=true;      frconfig.edtProxyUser.Enabled:=true;      frconfig.edtProxyPass.Enabled:=true;      frconfig.lblHTTPhost.Enabled:=true;      frconfig.lblSSLhost.Enabled:=true;      frconfig.lblFTPhost.Enabled:=true;      frconfig.lblHTTPport.Enabled:=true;      frconfig.lblSSLport.Enabled:=true;      frconfig.lblFTPport.Enabled:=true;      frconfig.lblNoProxyHosts.Enabled:=true;      frconfig.lblProxyUser.Enabled:=true;      frconfig.lblProxyPass.Enabled:=true;      frconfig.lblNoProxyHelp.Enabled:=true;      frconfig.seHTTPport.Enabled:=true;      frconfig.seSSLport.Enabled:=true;      frconfig.seFTPport.Enabled:=true;      frconfig.chSameProxy.Enabled:=true;      frconfig.chUseAuth.Enabled:=true;      frconfig.chUseAuthChange(nil);      frconfig.chSameProxyChange(nil);    end;  end;end;procedure Tfrconfig.cbQueueChange(Sender: TObject);begin  frconfig.chEnableScheduler.Checked:=qtimerenable[frconfig.cbQueue.ItemIndex];  frconfig.chDaily.Checked:=qallday[frconfig.cbQueue.ItemIndex];  frconfig.dtpStartQueue.Time:=queuestarttimes[frconfig.cbQueue.ItemIndex];  frconfig.deStartQueue.Date:=queuestartdates[frconfig.cbQueue.ItemIndex];  frconfig.chStopQueue.Checked:=qstop[frconfig.cbQueue.ItemIndex];  frconfig.dtpStopQueue.Time:=queuestoptimes[frconfig.cbQueue.ItemIndex];  frconfig.deStopQueue.Date:=queuestopdates[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[0]:=qdomingo[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[1]:=qlunes[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[2]:=qmartes[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[3]:=qmiercoles[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[4]:=qjueves[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[5]:=qviernes[frconfig.cbQueue.ItemIndex];  frconfig.chgWeekDays.Checked[6]:=qsabado[frconfig.cbQueue.ItemIndex];  frconfig.chDisableLimits.Checked:=queuelimits[frconfig.cbQueue.ItemIndex];  frconfig.chShutdown.Checked:=queuepoweroff[frconfig.cbQueue.ItemIndex];  frconfig.chEnableSchedulerChange(nil);end;procedure Tfrconfig.deDownFolderAcceptDirectory(Sender: TObject;  var Value: String);var  i:integer;begin  frconfirm.dlgtext.Caption:=fstrings.rootdownloadpathchange;  frconfirm.ShowModal;  if dlgcuestion then  begin   for i:=0 to Length(categoryextencionstmp)-1 do   begin    categoryextencionstmp[i][0]:=Value+pathdelim+ExtractFileName(categoryextencionstmp[i][0]);   end;  end;end;procedure Tfrconfig.FormShow(Sender: TObject);begin  frconfig.cbProxyChange(nil);  frconfig.chEnableSchedulerChange(nil);  frconfig.chUseAuthChange(nil);  frconfig.chSameProxyChange(nil);  frconfig.chQueueRotateChange(nil);  frconfig.chLoadLogsChange(nil);  categoryreload();end;procedure Tfrconfig.lbCategorySelectionChange(Sender: TObject; User: boolean);var  x:integer;begin  frconfig.lbExtensions.Items.Clear;  if frconfig.lbCategory.ItemIndex<>-1 then  begin    frconfig.deCategoryDownFolder.Text:=categoryextencionstmp[frconfig.lbCategory.ItemIndex][0];    for x:=2 to categoryextencionstmp[frconfig.lbCategory.ItemIndex].Count-1 do    begin      frconfig.lbExtensions.Items.Add(UpperCase(categoryextencionstmp[frconfig.lbCategory.ItemIndex][x]));    end;  end;end;procedure Tfrconfig.PageControl1Change(Sender: TObject);begin  frconfig.tvConfig.Items[frconfig.PageControl1.ActivePageIndex].Selected:=true;end;procedure Tfrconfig.btnPlayCompleteClick(Sender: TObject);begin  playsound(frconfig.fneSoundComplete.Text);end;procedure Tfrconfig.btnPlayStoppedClick(Sender: TObject);begin  playsound(frconfig.fneSoundStopped.Text);end;procedure Tfrconfig.btnAddQueueClick(Sender: TObject);var  i:integer;begin  newqueue();  frconfig.cbQueue.Items.Clear;  for i:=0 to Length(queues)-1 do  begin    frconfig.cbQueue.Items.Add(queuenames[i]);  end;  frconfig.cbQueue.ItemIndex:=Length(queues)-1;end;procedure Tfrconfig.btnAddCategoryClick(Sender: TObject);begin  fradd.edtValue.Text:='';  fradd.ShowModal;  if ok and (fradd.edtValue.Text<>'') then  begin    SetLength(categoryextencionstmp,Length(categoryextencionstmp)+1);    categoryextencionstmp[Length(categoryextencionstmp)-1]:=TStringList.Create;    categoryextencionstmp[Length(categoryextencionstmp)-1].add(ddowndir+pathdelim+fradd.edtValue.Text);    categoryextencionstmp[Length(categoryextencionstmp)-1].add(fradd.edtValue.Text);    categoryreload();  end;end;procedure Tfrconfig.btnDeleteCategoryClick(Sender: TObject);begin  if frconfig.lbCategory.ItemIndex <> -1 then    categorydelete(frconfig.lbCategory.ItemIndex);end;procedure Tfrconfig.btnAddExtensionClick(Sender: TObject);begin  if frconfig.lbCategory.ItemIndex<>-1 then  begin    fradd.edtValue.Text:='';    fradd.ShowModal;    if ok and (fradd.edtValue.Text<>'') then    begin      categoryextencionstmp[frconfig.lbCategory.ItemIndex].Add(fradd.edtValue.Text);      extencionreload();    end;  end;end;procedure Tfrconfig.btnDeleteExtensionClick(Sender: TObject);begin  if (frconfig.lbExtensions.ItemIndex<>-1) and (frconfig.lbCategory.ItemIndex<>-1) then  begin    categoryextencionstmp[frconfig.lbCategory.ItemIndex].Delete(frconfig.lbExtensions.ItemIndex+2);    extencionreload();  end;end;procedure Tfrconfig.btnEditCategoryClick(Sender: TObject);begin  if frconfig.lbCategory.ItemIndex<>-1 then  begin    fradd.edtValue.Text:=frconfig.lbCategory.Items[frconfig.lbCategory.ItemIndex];    fradd.ShowModal;    if ok then    begin      categoryextencionstmp[frconfig.lbCategory.ItemIndex][1]:=fradd.edtValue.Text;      categoryreload();    end;  end;end;procedure Tfrconfig.tvConfigSelectionChanged(Sender: TObject);begin  Pagecontrol1.TabIndex:=tvConfig.Selected.Index;  pConfigInfo.Caption:=tvConfig.Selected.Text;end;procedure Tfrconfig.btnConfigAcceptClick(Sender: TObject);var  validate:boolean;  n:integer;begin  validate:=false;  if frconfig.chDaily.Checked and frconfig.chEnableScheduler.Checked then  begin    for n:=0 to frconfig.chgWeekDays.Items.Count-1 do    begin      if frconfig.chgWeekDays.Checked[n] then        validate:=true;    end;  end  else    validate:=true;  if validate then  begin    fmain.setconfig();    frconfig.Close;  end  else  begin    ShowMessage(fstrings.msgmustselectweekday);    frconfig.tsScheduler.Show;  end;end;end.